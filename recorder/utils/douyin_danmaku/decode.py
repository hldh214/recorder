import recorder.utils.douyin_danmaku.message_pb2 as message_pb2
import gzip
from google.protobuf.json_format import MessageToDict

# https://gitee.com/tandaoli/tiktok-live-data-acquisition/blob/master/1.dy%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3(2022.11.15%E5%8F%AF%E7%94%A8)/2.%E7%9B%B4%E6%92%AD%E5%BC%B9%E5%B9%95protobuf%E8%A7%A3%E6%9E%90.md
# hex来自上方的粘贴
hex = '082110d2af89a3fdf6cda15a18b84520082a150a0d636f6d70726573735f747970651204677a69702ab9020a0f696d2d696e7465726e616c5f65787412a502696e7465726e616c5f7372633a707573687365727665727c7773735f707573685f726f6f6d5f69643a373138353430343730313235313235393139317c7773735f707573685f6469643a373138353033313537393332333034313331397c7773735f707573685f6c6f675f69643a363530343130333534393533343838353834327c7773735f66657463685f6d733a313637323939313834323535357c7773735f707573685f6d733a313637323939313834323634347c7773735f6d73675f747970653a727c777264735f6b76733a57656263617374526f6f6d52616e6b4d6573736167652d313637323939313539383535333432383435345f57656263617374526f6f6d53746174734d6573736167652d313637323939313833323530363332343437322a440a09696d2d637572736f721237742d313637323939313834323634345f722d373138353434353234373836343833373538395f642d315f752d315f682d315f7264632d312a170a06696d2d6e6f77120d313637323939313834323634342a190a0e696d2d6c6976655f637572736f721207642d315f752d31320270623a036d736742be101f8b08000000000000ffec9a6d6c53d719c739be69ec5c20583794b954da2c671f0a93c9b9e7be47da563b8d6129a1212110c2d6a3ebeb6be71adbd7dc6b3b2fb453c74a0704d68c5594a6cb4661553bfa2246598bd2154a35a963aab6eec3a66ad1be74711c32214d55d77dd83a4dce9bad608f989295c1f517ebde73cf79ce799e739effef1c1df28d6672f50e35a8c866aa558d0755a355354d39a2524f3593e756972e73be79ecf5d71f3ffcf731c5f5c6b1ef1e3efeb7bf8e2910f83fa923ef8e6919151bba1ec76a22a51a38a5cb668aba672f6c4c9baaf1a87b62e4f9f1d127f6d28d66cad0129147d7d69235f541313cfd730f119e9fd73996532b487bbdd8d42c0402ee21e23418a92387eb1c1f4fbc3b9803ce3fed1bba605b7b77f6cc93d99ffe6cfcad8bb9e1c7b3bf7c3abbff4c76ffa01bb40c907d3da954d26c6c6848d2f486909eeed712494dd9a0e8f106b9578dab0d34847d3484334f5e3923a764a321a59b5e25e1d5bc50a4192c8478240812cb21885856a12518848865c2a222f09c22311ba24935f2f5b0a1c7bfca405ee0059a61d8d3204ab6e78de76d33dede19cf2de882168f34cc96ccfd633914d71238288722ea866422f2ed543296f1eac1e8062d2e475497d3ed8484bfd6b362e2c0c5dcabcf650707732f9d380d06c8ce4a8ce5fd8f23861c52714ccda8319ce13082a5edb921f0dfeb5aedf9c2e4915393a70fe65e39981b7d01c1dce80b73c60f02b263ce3abf08eb6139612ab17470ce368f69a6846d68f743b2e6cac8d1c9e74e658fbc44d9eb03d33fd74a8f6bfe6deeecc1f1f323d9674fce74e62c7038fe0d9ce76d2e300a7e05e0ea61f0ad2575cd4980c91d950c7e7aa2e1a4dc3f6b04f5610431624b5958e15e01c13b60cc4e4e12459e70ae7401cfef08f2f7c061a3de5b1ae7171a5d8cd316d928e5be5e05f22a70545193a0e0d31b358ffbe2c952e3aa285815344c7d793195daabc9aa65cbbe4675cffe5385a8c2bf1cfbf1a17fdaa8ab840350776ebc6f7258966c22ddac78efb3553b81c776d7f2b3b61a9e17688e1711ff914d68ed607b37477d7e9fcfe7db82b7777642dcd72df4c97bc21a565157eba6812d1936d8cdf33e3d2ac4d42d580868febead6708628af81f4acf14f1394acf14710b49cf1431b274690b32957768e1dc1baa0227ab4ab3d26faa36ceccb7b6ee6830da26a95a42f7eeeed4b7ed6c0da533bb373727ba703f6a86526ccb030f36f5b4c6ba7676a66221e40d6dd15b3a7d819eadd1fe8de1745754dc04da40d7d0af6d0700f1367886a22c56b358cd6235e24ee39adb91552a62b53b8c6bee8c785bac66b1da6dc46aae976bdac0c031bbc341d5acb7d7fb1889179a3cc336b23ea384f08cf8cd8f7be6084f0d87552585136a2f75effc395ef6d089ecfee7c7479fc83d7b6ee2e82b579e3eb7760539376af710e17917389653b6fbc169f0162047c12c119661c11b5f4f4befb1f55701b9ab926993776469170623a532ddae4a1648858d53f72db6e27a7b7db3ff01b1a959fcce5dfe411bf970a543fe2f73a7d4a81fae74d495b54f7da582ba2ea7db05817f4de915dc52851042d1aa952bd7ad1bc82f9aa6261fe36fde079c64cdac0bb510452048ef03f7902b675f997ada5054ca3167345f46a6743c9d5fb510b59c47904122c3b12c3b04de3e6f3b0e5eb61d05bf584dae99cbf7c5c7e85a925a37bff8ae3c363c79f17beebd7463d250c3f387eac83a54b7366ad646cddaa859e06e6dd4eeb8785b1b356ba3761b6dd43cf7396aa9da626413c13ba08eac89f7e3b01e8be9bd547576ff6b13afbde8b139c030f8109063a0f2191493836a0c1b6a241d930dacf4c82561bdb392a9b1e86629cff5abacb7d70b3e8ee1182770811701e19abf7a427ee82d7373e5a297fc6055999b2ba78e5d7eefd3c18537578657dd849b2b7fa8bd16b22fd592176a1daf4e3e76f0c291038473ecfbff383106d6564f1cff61eecd275b34327243581dd74d5953bc3135222bfd9811241a7390e1041a414e2a43d17de4b64a83b830bb48e593cb5a578d674d7172918ab0f60028a4d11bcb2d42f9d4f2cce1dc533f191f1d2dac64bbc735fff61aaaad72d439d78c824b00d60c836f2ea54f4e1603f30d026d99f66771f613827478aac92ac7326a1975254f3be34491479c7617f05c26c8a93ced6401b9fd33c6a01cec6cff6ca9ba5cbb54fd22ea5c833abfcda3cee525997095b1c0e2daa4be749defa9423ce1fb87dffff3a71fff80d8675b76d6b69c13458e6711c740e123dbe662ca49ef34bb9b3bf6247cbd0f066425bd3b19e23429105718ae356e6e7c68e766b1a50f727d12cb04cc4dc656755b4b20d1d1b19d6bfa86d7f0329d4dd3e8f3b9e58b29e2d6c91753c4a1255b3750f47fb14c7faa4b73c714f1a3a5eb0d53b9774a72d1acb6154088f6f744bb5b5a77d0ba6feb4ea1a93fbea7a5c917c808d2435a57ba870978db658946fa66251ce88e411e75ea5d46db766f2a32e06f4f275064e1ed024b4f6f9df561e9a9a5a7969e5a7a6ae9e9ff8f9ebaced4b481a3c0daf25a126d49b425d196445b126d49f42d26d1f3a7d4d4ae9497e6052449b4c8228ee3b1e115689163590eb182c8b3222370a284435e1aa7674a1824d21c62595ae47991c33d736f055e9020cf323c94246c84142fed9ab4bbff75e98f673e80eb476c5a9e0012720c9b86d2984c9b3da66a6454e3915ed3c4f9c7194ed0428dd3cd41568034e268c449b444173e0a69a1469e47286f9d6551a120a647f295790eb234643856e2185614598616a6bf09ab29a507c7cdc6e2c17285ea0b4af8e992b819c1a9fea4da683cd26b844cbc3b6336ce1efab7eb7abc5d4eec9e3df69ff32127891cc7b048643916177dda919253e6826f450671906710cb0ae8fe559bc07f000000ffff010000ffffad31cc2c2a3b0000'

data = bytes.fromhex(hex)
o = message_pb2.PushFrame()
o.ParseFromString(data)

payload = gzip.decompress(o.palyload)
r = message_pb2.Response()
r.ParseFromString(payload)
print(r)
e = r
messagelist = e.messages
for t in messagelist:
    o = t.payload
    message_ = ''
    if t.method == "WebcastLikeMessage":
        message_ = message_pb2.LikeMessage()
        message_.ParseFromString(o)
    elif t.method == "WebcastChatMessage":
        message_ = message_pb2.ChatMessage()
        message_.ParseFromString(o)
    elif t.method == "WebcastMemberMessage":
        message_ = message_pb2.MemberMessage()
        message_.ParseFromString(o)
    elif t.method == "WebcastSocialMessage":
        message_ = message_pb2.SocialMessage()
        message_.ParseFromString(o)
    elif t.method == "WebcastGiftMessage":
        message_ = message_pb2.GiftMessage()
        message_.ParseFromString(o)
    else:
        print(t.method)
    if message_:
        obj1 = MessageToDict(message_, preserving_proto_field_name=True)
        print('秋恋猫逆向教学vx:crazy20010110')
        print(obj1)
